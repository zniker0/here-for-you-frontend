<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Service - HereForYou</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <div class="nav-brand">
                <i class="fas fa-home"></i>
                <span>HereForYou</span>
            </div>
            <div class="nav-links">
                <a href="dashboard.html" class="nav-link">Dashboard</a>
                <button class="btn-secondary" onclick="window.history.back()">Back</button>
            </div>
        </nav>
    </header>

    <main>
        <div class="booking-container">
            <div class="booking-header">
                <h1>Book Your Service</h1>
                <p>Schedule your appointment with a verified professional</p>
            </div>

            <div class="booking-content">
                <!-- Professional Summary -->
                <div class="booking-summary">
                    <h3>Service Details</h3>
                    <div class="service-summary">
                        <div class="professional-info">
                            <div class="professional-avatar">S</div>
                            <div>
                                <h4>Suresh Kumar</h4>
                                <p>Plumbing Services</p>
                                <div class="rating">
                                    <span class="stars">★★★★★</span>
                                    <span>4.8 (156 reviews)</span>
                                </div>
                            </div>
                        </div>
                        <div class="service-price">
                            <span class="price-label">Starting from</span>
                            <span class="price-amount">₹300/hour</span>
                        </div>
                    </div>
                </div>

                <!-- Booking Form -->
                <div class="booking-form-container">
                    <form id="bookingForm" class="booking-form">
                        <!-- Date Selection -->
                        <div class="form-section">
                            <h4><i class="fas fa-calendar"></i> Select Date</h4>
                            <div id="calendarContainer" class="calendar-container">
                                <!-- Calendar will be populated by JavaScript -->
                            </div>
                        </div>

                        <!-- Time Selection -->
                        <div class="form-section">
                            <h4><i class="fas fa-clock"></i> Select Time</h4>
                            <div id="timeSlotsContainer" class="time-slots-container">
                                <p class="text-center">Please select a date first</p>
                            </div>
                        </div>

                        <!-- Service Address -->
                        <div class="form-section">
                            <h4><i class="fas fa-map-marker-alt"></i> Service Address</h4>
                            <div class="form-group">
                                <label for="address">Full Address</label>
                                <textarea id="address" name="address" rows="3" required 
                                         placeholder="Enter your complete address including landmarks"></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="pincode">Pincode</label>
                                    <input type="text" id="pincode" name="pincode" required 
                                           placeholder="682001">
                                </div>
                                <div class="form-group">
                                    <label for="city">City</label>
                                    <input type="text" id="city" name="city" value="Kochi" required>
                                </div>
                            </div>
                        </div>

                        <!-- Service Details -->
                        <div class="form-section">
                            <h4><i class="fas fa-tools"></i> Service Requirements</h4>
                            <div class="form-group">
                                <label for="serviceType">Type of Service</label>
                                <select id="serviceType" name="serviceType" required>
                                    <option value="">Select service type</option>
                                    <option value="pipe-repair">Pipe Repair</option>
                                    <option value="bathroom-fitting">Bathroom Fitting</option>
                                    <option value="water-heater">Water Heater Service</option>
                                    <option value="drainage">Drainage Cleaning</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="description">Problem Description</label>
                                <textarea id="description" name="description" rows="4" 
                                         placeholder="Describe the issue in detail to help the professional prepare better"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="urgency">Urgency Level</label>
                                <select id="urgency" name="urgency">
                                    <option value="normal">Normal</option>
                                    <option value="urgent">Urgent (Same day)</option>
                                    <option value="emergency">Emergency (ASAP)</option>
                                </select>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="form-section">
                            <h4><i class="fas fa-phone"></i> Contact Information</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="contactName">Contact Person</label>
                                    <input type="text" id="contactName" name="contactName" required 
                                           placeholder="Your name">
                                </div>
                                <div class="form-group">
                                    <label for="contactPhone">Phone Number</label>
                                    <input type="tel" id="contactPhone" name="contactPhone" required 
                                           placeholder="Your phone number">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="alternateContact">Alternate Contact (Optional)</label>
                                <input type="tel" id="alternateContact" name="alternateContact" 
                                       placeholder="Alternate phone number">
                            </div>
                        </div>

                        <!-- Payment Method -->
                        <div class="form-section">
                            <h4><i class="fas fa-credit-card"></i> Payment Method</h4>
                            <div class="payment-options">
                                <label class="payment-option">
                                    <input type="radio" name="paymentMethod" value="cash" checked>
                                    <div class="payment-card">
                                        <i class="fas fa-money-bill-wave"></i>
                                        <span>Cash After Service</span>
                                    </div>
                                </label>
                                <label class="payment-option">
                                    <input type="radio" name="paymentMethod" value="upi">
                                    <div class="payment-card">
                                        <i class="fas fa-mobile-alt"></i>
                                        <span>UPI Payment</span>
                                    </div>
                                </label>
                                <label class="payment-option">
                                    <input type="radio" name="paymentMethod" value="card">
                                    <div class="payment-card">
                                        <i class="fas fa-credit-card"></i>
                                        <span>Credit/Debit Card</span>
                                    </div>
                                </label>
                                <label class="payment-option">
                                    <input type="radio" name="paymentMethod" value="wallet">
                                    <div class="payment-card">
                                        <i class="fas fa-wallet"></i>
                                        <span>Digital Wallet</span>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Special Instructions -->
                        <div class="form-section">
                            <h4><i class="fas fa-info-circle"></i> Special Instructions</h4>
                            <div class="form-group">
                                <textarea id="instructions" name="instructions" rows="3" 
                                         placeholder="Any special instructions for the professional (e.g., gate code, parking instructions, etc.)"></textarea>
                            </div>
                        </div>

                        <!-- Terms and Conditions -->
                        <div class="form-section">
                            <div class="terms-section">
                                <label class="checkbox-container">
                                    <input type="checkbox" id="agreeTerms" required>
                                    <span class="checkmark"></span>
                                    I agree to the <a href="terms.html" target="_blank">Terms & Conditions</a> 
                                    and <a href="privacy.html" target="_blank">Privacy Policy</a>
                                </label>
                                <label class="checkbox-container">
                                    <input type="checkbox" id="agreeContact">
                                    <span class="checkmark"></span>
                                    I consent to being contacted by the professional for service coordination
                                </label>
                            </div>
                        </div>

                        <!-- Booking Summary -->
                        <div class="booking-final-summary">
                            <h4>Booking Summary</h4>
                            <div class="summary-item">
                                <span>Service:</span>
                                <span id="summaryService">Plumbing</span>
                            </div>
                            <div class="summary-item">
                                <span>Professional:</span>
                                <span id="summaryProfessional">Suresh Kumar</span>
                            </div>
                            <div class="summary-item">
                                <span>Date & Time:</span>
                                <span id="summaryDateTime">Select date and time</span>
                            </div>
                            <div class="summary-item">
                                <span>Estimated Cost:</span>
                                <span id="summaryCost">₹300 - ₹500</span>
                            </div>
                            <div class="summary-note">
                                <i class="fas fa-info-circle"></i>
                                <span>Final cost will be determined based on actual work required</span>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="form-actions">
                            <button type="button" class="btn-outline" onclick="window.history.back()">
                                Cancel
                            </button>
                            <button type="submit" class="btn-primary large">
                                <i class="fas fa-check"></i> Confirm Booking
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 HereForYou. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="script.js"></script>
    <script>
        // Initialize booking form
        document.addEventListener('DOMContentLoaded', function() {
            const user = getCurrentUser();
            if (user) {
                document.getElementById('contactName').value = user.name || '';
                document.getElementById('contactPhone').value = user.phone || '';
            }
            
            // Initialize booking form submission
            document.getElementById('bookingForm').addEventListener('submit', function(e) {
                e.preventDefault();
                handleBookingSubmission();
            });
            
            // Update summary when form changes
            document.addEventListener('change', updateBookingSummary);
        });
        
        function handleBookingSubmission() {
            const selectedDate = document.querySelector('.calendar-day.selected');
            const selectedTime = document.querySelector('.time-slot.selected');
            
            if (!selectedDate || !selectedTime) {
                showNotification('Please select date and time', 'error');
                return;
            }
            
            if (!document.getElementById('agreeTerms').checked) {
                showNotification('Please agree to terms and conditions', 'error');
                return;
            }
            
            // Collect form data
            const formData = new FormData(document.getElementById('bookingForm'));
            const bookingData = {
                id: 'BK' + Date.now(),
                date: selectedDate.textContent,
                time: selectedTime.textContent,
                status: 'confirmed',
                professional: 'Suresh Kumar',
                service: 'Plumbing',
                address: formData.get('address'),
                serviceType: formData.get('serviceType'),
                paymentMethod: formData.get('paymentMethod'),
                createdAt: new Date().toISOString()
            };
            
            // Save booking
            const existingBookings = JSON.parse(localStorage.getItem('userBookings')) || [];
            existingBookings.push(bookingData);
            localStorage.setItem('userBookings', JSON.stringify(existingBookings));
            
            showNotification('Booking confirmed successfully!');
            
            // Redirect to confirmation page
            setTimeout(() => {
                window.location.href = `booking-confirmation.html?id=${bookingData.id}`;
            }, 1500);
        }
        
        function updateBookingSummary() {
            const selectedDate = document.querySelector('.calendar-day.selected');
            const selectedTime = document.querySelector('.time-slot.selected');
            const serviceType = document.getElementById('serviceType').value;
            
            if (selectedDate && selectedTime) {
                document.getElementById('summaryDateTime').textContent = 
                    `Jan ${selectedDate.textContent}, 2024 at ${selectedTime.textContent}`;
            }
            
            if (serviceType) {
                document.getElementById('summaryService').textContent = 
                    serviceType.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
            }
        }
        
        // Enhanced calendar rendering for booking
        function renderBookingCalendar() {
            const calendarContainer = document.getElementById('calendarContainer');
            if (!calendarContainer) return;
            
            const today = new Date();
            const calendar = [];
            
            // Generate next 30 days
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                calendar.push(date);
            }
            
            calendarContainer.innerHTML = `
                <div class="calendar-header">
                    <h4>January 2024</h4>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-day-header">Sun</div>
                    <div class="calendar-day-header">Mon</div>
                    <div class="calendar-day-header">Tue</div>
                    <div class="calendar-day-header">Wed</div>
                    <div class="calendar-day-header">Thu</div>
                    <div class="calendar-day-header">Fri</div>
                    <div class="calendar-day-header">Sat</div>
                    ${generateBookingCalendarDays()}
                </div>
            `;
        }
        
        function generateBookingCalendarDays() {
            const days = [];
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Add empty cells for previous month
            for (let i = 0; i < firstDay; i++) {
                days.push('<div class="calendar-day empty"></div>');
            }
            
            // Add days of current month
            for (let day = 1; day <= daysInMonth; day++) {
                const isPast = day < today.getDate();
                const isToday = day === today.getDate();
                const isAvailable = !isPast && Math.random() > 0.2; // 80% availability
                
                let classes = 'calendar-day';
                if (isPast) classes += ' past';
                else if (isAvailable) classes += ' available';
                else classes += ' unavailable';
                if (isToday) classes += ' today';
                
                const onclick = isAvailable ? `onclick="selectBookingDate(${day})"` : '';
                
                days.push(`<div class="${classes}" ${onclick}>${day}</div>`);
            }
            
            return days.join('');
        }
        
        function selectBookingDate(day) {
            // Remove previous selection
            document.querySelectorAll('.calendar-day').forEach(dayEl => {
                dayEl.classList.remove('selected');
            });
            
            // Add selection to clicked date
            event.target.classList.add('selected');
            
            // Render available time slots
            renderBookingTimeSlots(day);
            updateBookingSummary();
        }
        
        function renderBookingTimeSlots(day) {
            const timeSlotsContainer = document.getElementById('timeSlotsContainer');
            if (!timeSlotsContainer) return;
            
            const timeSlots = [
                '09:00 AM', '10:00 AM', '11:00 AM', '12:00 PM',
                '02:00 PM', '03:00 PM', '04:00 PM', '05:00 PM', '06:00 PM'
            ];
            
            // Randomly make some slots unavailable
            const availableSlots = timeSlots.filter(() => Math.random() > 0.3);
            
            timeSlotsContainer.innerHTML = `
                <h5>Available Time Slots for January ${day}</h5>
                <div class="time-slots">
                    ${availableSlots.map(time => `
                        <div class="time-slot" onclick="selectBookingTimeSlot('${time}')">
                            ${time}
                        </div>
                    `).join('')}
                </div>
                ${availableSlots.length === 0 ? '<p class="no-slots">No slots available for this date</p>' : ''}
            `;
        }
        
        function selectBookingTimeSlot(time) {
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            event.target.classList.add('selected');
            updateBookingSummary();
        }
        
        // Initialize calendar when page loads
        if (document.getElementById('calendarContainer')) {
            renderBookingCalendar();
        }
        
        // Enhanced styles for booking page
        const style = document.createElement('style');
        style.textContent = `
            .booking-container {
                max-width: 900px;
                margin: 0 auto;
                padding: 2rem 20px;
            }
            
            .booking-header {
                text-align: center;
                margin-bottom: 2rem;
            }
            
            .booking-header h1 {
                color: var(--text-primary);
                margin-bottom: 0.5rem;
            }
            
            .booking-content {
                display: grid;
                gap: 2rem;
            }
            
            .booking-summary {
                background: var(--white);
                padding: 2rem;
                border-radius: var(--border-radius);
                box-shadow: var(--shadow);
            }
            
            .service-summary {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 1rem;
            }
            
            .professional-info {
                display: flex;
                align-items: center;
                gap: 1rem;
            }
            
            .service-price {
                text-align: right;
            }
            
            .price-label {
                display: block;
                font-size: 0.9rem;
                color: var(--text-secondary);
            }
            
            .price-amount {
                font-size: 1.5rem;
                font-weight: bold;
                color: var(--primary-color);
            }
            
            .booking-form-container {
                background: var(--white);
                border-radius: var(--border-radius);
                box-shadow: var(--shadow);
                overflow: hidden;
            }
            
            .form-section {
                padding: 2rem;
                border-bottom: 1px solid var(--border-color);
            }
            
            .form-section:last-child {
                border-bottom: none;
            }
            
            .form-section h4 {
                color: var(--text-primary);
                margin-bottom: 1.5rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            
            .form-section h4 i {
                color: var(--primary-color);
            }
            
            .form-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }
            
            .calendar-container {
                background: var(--background-color);
                border-radius: 8px;
                padding: 1rem;
            }
            
            .calendar-header {
                text-align: center;
                margin-bottom: 1rem;
            }
            
            .calendar-grid {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 2px;
                background: var(--border-color);
                border-radius: 8px;
                overflow: hidden;
            }
            
            .calendar-day-header {
                background: var(--text-primary);
                color: var(--white);
                padding: 0.5rem;
                text-align: center;
                font-weight: bold;
                font-size: 0.8rem;
            }
            
            .calendar-day {
                aspect-ratio: 1;
                background: var(--white);
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: var(--transition);
                position: relative;
            }
            
            .calendar-day.empty {
                background: var(--background-color);
                cursor: default;
            }
            
            .calendar-day.past {
                background: #F8F9FA;
                color: var(--text-secondary);
                cursor: not-allowed;
            }
            
            .calendar-day.available {
                background: var(--white);
                color: var(--text-primary);
            }
            
            .calendar-day.available:hover {
                background: var(--primary-color);
                color: var(--white);
                transform: scale(1.05);
            }
            
            .calendar-day.unavailable {
                background: #F8D7DA;
                color: var(--error-color);
                cursor: not-allowed;
            }
            
            .calendar-day.selected {
                background: var(--primary-color);
                color: var(--white);
                font-weight: bold;
            }
            
            .calendar-day.today {
                border: 2px solid var(--secondary-color);
            }
            
            .time-slots-container {
                background: var(--background-color);
                border-radius: 8px;
                padding: 1rem;
            }
            
            .time-slots {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 0.5rem;
                margin-top: 1rem;
            }
            
            .time-slot {
                padding: 0.75rem;
                background: var(--white);
                border: 2px solid var(--border-color);
                border-radius: 8px;
                text-align: center;
                cursor: pointer;
                transition: var(--transition);
                font-weight: 500;
            }
            
            .time-slot:hover {
                border-color: var(--primary-color);
                background: var(--primary-color);
                color: var(--white);
            }
            
            .time-slot.selected {
                background: var(--primary-color);
                color: var(--white);
                border-color: var(--primary-color);
            }
            
            .no-slots {
                text-align: center;
                color: var(--text-secondary);
                font-style: italic;
                margin-top: 1rem;
            }
            
            .payment-options {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin-top: 1rem;
            }
            
            .payment-option {
                cursor: pointer;
            }
            
            .payment-option input[type="radio"] {
                display: none;
            }
            
            .payment-card {
                padding: 1rem;
                border: 2px solid var(--border-color);
                border-radius: 8px;
                text-align: center;
                transition: var(--transition);
                background: var(--white);
            }
            
            .payment-card i {
                font-size: 1.5rem;
                color: var(--primary-color);
                margin-bottom: 0.5rem;
                display: block;
            }
            
            .payment-option input[type="radio"]:checked + .payment-card {
                border-color: var(--primary-color);
                background: var(--primary-color);
                color: var(--white);
            }
            
            .payment-option input[type="radio"]:checked + .payment-card i {
                color: var(--white);
            }
            
            .terms-section {
                background: var(--background-color);
                padding: 1rem;
                border-radius: 8px;
            }
            
            .checkbox-container {
                display: flex;
                align-items: flex-start;
                cursor: pointer;
                font-size: 0.9rem;
                line-height: 1.4;
                margin-bottom: 1rem;
            }
            
            .checkbox-container:last-child {
                margin-bottom: 0;
            }
            
            .checkbox-container input[type="checkbox"] {
                width: auto;
                margin-right: 0.5rem;
                margin-top: 0.1rem;
                transform: scale(1.2);
            }
            
            .checkbox-container a {
                color: var(--primary-color);
                text-decoration: none;
            }
            
            .checkbox-container a:hover {
                text-decoration: underline;
            }
            
            .booking-final-summary {
                background: var(--background-color);
                padding: 1.5rem;
                border-radius: 8px;
                margin-top: 1rem;
            }
            
            .booking-final-summary h4 {
                margin-bottom: 1rem;
                color: var(--text-primary);
            }
            
            .summary-item {
                display: flex;
                justify-content: space-between;
                margin-bottom: 0.5rem;
                padding-bottom: 0.5rem;
                border-bottom: 1px solid var(--border-color);
            }
            
            .summary-item:last-of-type {
                border-bottom: none;
                font-weight: bold;
                color: var(--primary-color);
            }
            
            .summary-note {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                margin-top: 1rem;
                padding: 0.75rem;
                background: var(--white);
                border-radius: 6px;
                font-size: 0.9rem;
                color: var(--text-secondary);
            }
            
            .summary-note i {
                color: var(--secondary-color);
            }
            
            .form-actions {
                display: flex;
                gap: 1rem;
                justify-content: flex-end;
                padding: 2rem;
                background: var(--background-color);
            }
            
            .btn-primary.large {
                padding: 1rem 2rem;
                font-size: 1.1rem;
                font-weight: bold;
            }
            
            @media (max-width: 768px) {
                .booking-container {
                    padding: 1rem;
                }
                
                .service-summary {
                    flex-direction: column;
                    gap: 1rem;
                    text-align: center;
                }
                
                .form-row {
                    grid-template-columns: 1fr;
                }
                
                .payment-options {
                    grid-template-columns: 1fr;
                }
                
                .form-actions {
                    flex-direction: column;
                }
                
                .calendar-grid {
                    gap: 1px;
                }
                
                .time-slots {
                    grid-template-columns: repeat(2, 1fr);
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>